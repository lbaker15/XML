<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css"> -->
    <title>Test</title>
    <style>
        body {
            background: black;
        }

        #content {
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 400px;
        }

        .divStyle {
            font-family: Manrope;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-direction: column;
            gap: 20px;
            color: white;
        }

        .divStyle button {
            border: none;
            background: white;
            font-family: Manrope;
            padding: 5px 20px;
        }

        .divStyle .active {
            background: rgb(127, 212, 127);
        }
    </style>
    <script>
        async function getData(url = '') {
            const response = await fetch(url, {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Content-Type': 'text/plain',
                    'Accept': 'text/plain'
                },
                redirect: 'follow',
                referrerPolicy: 'no-referrer'
            });
            return response.text();
        }
        async function postData(url = '', body) {
            const response = await fetch(url, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'text/plain',
                    'Accept': 'text/plain'
                },
                redirect: 'follow',
                referrerPolicy: 'no-referrer',
                body: body
            });
            return response.text();
        }
        const postTheData = (e) => {
            let body = `<?xml version="1.0"?>
                <?xml-stylesheet href="/dataview/dataview.xsl" type="text/xsl"?>
                <view xmlns="http://www.rockwellautomation.com/technologies/data_access/data_views/1.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.rockwellautomation.com/technologies/data_access/data_views/1.0/ /schema/dataview.xsd" xmlns:cip="http://www.rockwellautomation.com/technologies/data_access/data_types/1.0/" name="MainScreen" description="">
                    <tag name="Medical_SysOK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Medical_SysFault" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Medical_EmWest" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Medical_EmEast" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Medical_EmNorth" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Electric_SysOK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Electric_SysGlobOut" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Web_FireTest" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Fire_AlarmLight" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Web_Tornado_Warning" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Tornado_AlarmLight" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Elec_Serv1Fault" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">TRUE</value>
                    </tag>
                    <tag name="Elec_Serv2Fault" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Elec_Serv3Fault" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Elec_Serv4Fault" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Serv1_OK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Serv2_OK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">TRUE</value>
                    </tag>
                    <tag name="Serv3_OK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="Serv4_OK" valueType="cip:dt_BOOL" path="1,0" display="String" access="read" error="Couldn't read tag!">
                        <value xsi:nil="true"/>
                    </tag>
                    <tag name="Test_ModeOnInd" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                        <value xsi:type="cip:dt_BOOL">FALSE</value>
                    </tag>
                    <tag name="CorrectedClockTime" valueType="cip:dt_DINT" path="1,0" display="Decimal" access="read">
                        <value xsi:type="cip:dt_DINT">16</value>
                    </tag>
                    <tag name="Clock.Minute" valueType="cip:dt_DINT" path="1,0" display="Decimal" access="read">
                        <value xsi:type="cip:dt_DINT">31</value>
                    </tag>
                </view>
            `
            let value = (e.target.textContent === 'ON') ? 'FALSE' : 'TRUE';
            let newNode = `<tag name="${e.target.id}" valueType="cip:dt_BOOL" path="1,0" display="String" access="read">
                <value xsi:type="cip:dt_BOOL">${value}</value>
            </tag>`
            //FIND STRING WHERE name="{e.target.id}" -- DELETE TAG -- APPEND NEW NODE

            // let url = 'http://localhost:8000/user/system/dataviews/MainScreen.xml'
            // postData(url).then((value) => {
            //     console.log(value);
            // });
        }
        function test() {
            text = ''
            getData('http://localhost:8000/user/system/dataviews/MainScreen.xml')
                .then(value => new window.DOMParser().parseFromString(value, "text/xml"))
                .then(data => {
                    let content = document.getElementById('content');
                    let tags = Array.from(data.getElementsByTagName('tag'))
                    let array = new Array;
                    tags.map((tag, i) => {
                        let tagName = (tag.attributes.name).value;
                        let val = tag.childNodes[1]
                        if (Array.from(val.attributes)[0].value !== 'cip:dt_DINT') {
                            let el = document.createElement('button')
                            let el2 = document.createElement('label')
                            if (val.textContent === 'TRUE' | Array.from(val.attributes)[0].textContent === 'true') {
                                el.classList.add('active')
                                el.textContent = 'ON'
                            } else {
                                el.textContent = 'OFF'
                            }
                            el2.textContent = tagName;
                            el.value = tagName;
                            el.id = tagName;
                            el.addEventListener('click', postTheData)
                            let div = document.createElement('div')
                            div.append(el2, el)
                            div.classList.add('divStyle')
                            content.append(div)
                        } else {
                            let el = document.createElement('button')
                            let el2 = document.createElement('label')
                            el2.textContent = tagName;
                            el.textContent = val.textContent;
                            let div = document.createElement('div')
                            div.append(el2, el)
                            div.classList.add('divStyle')
                            content.append(div)
                        }
                    })
                })
        }
        window.addEventListener('load', () => {
            test()
        })
    </script>
</head>

<body>
    <h2>Main Screen</h2>
    <xml id="console">
    </xml>
    <div id="content"></div>
</body>

</html>